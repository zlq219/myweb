---------------------------------------------
2æœˆ14æ—¥ï¼Œç¬¬ä¸‰æ¬¡æ›´æ–° æ–°åŠŸèƒ½æ·»åŠ è¿‡ç¨‹
---------------------------------------------
æ·»åŠ æ–°åŠŸèƒ½çš„æµç¨‹ï¼ˆæœªæ¥ï¼‰
å½“ä½ æƒ³æ·»åŠ æ–°åŠŸèƒ½æ—¶ï¼ŒæŒ‰ç…§è¿™ä¸ªæµç¨‹ï¼š

æ­¥éª¤1ï¼šåˆ›å»ºæ–°è·¯ç”±æ–‡ä»¶
åœ¨ E:\zlq\myweb\routes\ ç›®å½•ä¸‹åˆ›å»ºæ–°æ–‡ä»¶ï¼Œæ¯”å¦‚ tools.pyï¼š

python
# routes/tools.py
from flask import Blueprint, render_template
from flask_login import login_required

tools_bp = Blueprint('tools', __name__)

@tools_bp.route('/tools')
@login_required
def index():
    return render_template('tools.html')

@tools_bp.route('/tools/calculator')
@login_required
def calculator():
    return render_template('calculator.html')
æ­¥éª¤2ï¼šåœ¨ app.py ä¸­æ³¨å†Œ
æ‰¾åˆ° app.py ä¸­æ³¨å†Œè“å›¾çš„éƒ¨åˆ†ï¼Œæ·»åŠ ä¸€è¡Œï¼š

python
# åœ¨ç°æœ‰çš„æ³¨å†Œåé¢æ·»åŠ 
from routes.tools import tools_bp
app.register_blueprint(tools_bp)
æ­¥éª¤3ï¼šåˆ›å»ºæ¨¡æ¿æ–‡ä»¶
åœ¨ E:\zlq\myweb\templates\ ä¸‹åˆ›å»º tools.htmlï¼š

html
{% extends "base.html" %}

{% block title %}å·¥å…· - MyWeb{% endblock %}

{% block user_content %}
<div class="container">
    <h1>å·¥å…·ä¸­å¿ƒ</h1>
    <p>è¿™é‡Œæ˜¯å„ç§å®ç”¨å·¥å…·</p>
</div>
{% endblock %}
æ­¥éª¤4ï¼šé…ç½®èœå•
åœ¨ config/admin_menu.py çš„ USER_MENU ä¸­æ·»åŠ ï¼š

python
{
    'title': 'å·¥å…·ä¸­å¿ƒ',
    'endpoint': 'tools.index',  # å¯¹åº”è“å›¾å.å‡½æ•°å
    'icon': 'fas fa-tools',      # ç›´æ¥å†™å›¾æ ‡å
    'permission': 'user',
    'order': 5
}
æƒé™æ§åˆ¶ç¤ºä¾‹
å¦‚æœéœ€è¦åªæœ‰ç®¡ç†å‘˜èƒ½è®¿é—®
åœ¨è·¯ç”±ä¸­æ·»åŠ  admin_required è£…é¥°å™¨ï¼š

python
from functools import wraps

def admin_required(f):
    @wraps(f)
    def decorated(*args, **kwargs):
        if not current_user.is_authenticated:
            return redirect(url_for('auth.login'))
        if not current_user.is_admin:
            flash('éœ€è¦ç®¡ç†å‘˜æƒé™', 'danger')
            return redirect(url_for('main.home'))
        return f(*args, **kwargs)
    return decorated

@tools_bp.route('/admin-tools')
@login_required
@admin_required
def admin_tools():
    return render_template('admin_tools.html')
ç„¶ååœ¨èœå•é…ç½®ä¸­è®¾ç½® permission: 'admin'

å¦‚æœéœ€è¦å…¬å¼€è®¿é—®
å»æ‰ @login_required è£…é¥°å™¨ï¼Œèœå•é…ç½®ä¸­è®¾ç½® permission: 'public'

å›¾æ ‡æŸ¥è¯¢ç½‘ç«™
æ‰€æœ‰å›¾æ ‡ä»è¿™é‡Œæ‰¾ï¼šhttps://fontawesome.com/icons

æœç´¢ä½ æƒ³è¦çš„åŠŸèƒ½

ç‚¹å‡»å›¾æ ‡ï¼Œå¤åˆ¶ fas fa-xxx æ ¼å¼çš„åç§°

ç›´æ¥ç²˜è´´åˆ°èœå•é…ç½®ä¸­

æ€»ç»“
âœ… ä½ çš„ç³»ç»Ÿå·²ç»å¯ä»¥ç‹¬ç«‹é…ç½®èœå•
âœ… ä¸éœ€è¦å†ä¿®æ”¹æ ¸å¿ƒæ–‡ä»¶
âœ… æœªæ¥æ·»åŠ æ–°åŠŸèƒ½åªéœ€è¦ï¼š

åˆ›å»ºè·¯ç”±æ–‡ä»¶

æ³¨å†Œè“å›¾

åˆ›å»ºæ¨¡æ¿

é…ç½®èœå•

ç»ˆäºå®ç°äº†é€æ­¥ç´¯åŠ çš„æ¶æ„ï¼
---------------------------------------
2æœˆ14æ—¥ï¼Œå¤šäºŒæ¬¡æ›´æ–°
-------------------------------------
  1. æ–°åŠŸèƒ½ä¸ç ´åæ¡†æ¶æ–‡ä»¶
æ˜¯çš„ï¼Œæ¡†æ¶è®¾è®¡å·²ç»æ”¯æŒæ–°åŠŸèƒ½æ‰©å±•ï¼š

æ·»åŠ æ–°åŠŸèƒ½çš„æ­¥éª¤ï¼š
åˆ›å»ºæ–°è·¯ç”±æ–‡ä»¶ï¼šåœ¨ routes/ ç›®å½•ä¸‹åˆ›å»º new_feature.py

æ³¨å†Œè“å›¾ï¼šåœ¨ app.py ä¸­æ³¨å†Œæ–°è“å›¾

é…ç½®èœå•ï¼šåœ¨ config/admin_menu.py ä¸­æ·»åŠ èœå•é¡¹

åˆ›å»ºæ¨¡æ¿ï¼šåœ¨ templates/ ä¸‹åˆ›å»ºå¯¹åº”çš„ HTML æ–‡ä»¶

ç¤ºä¾‹ï¼š

python
# routes/new_feature.py
from flask import Blueprint, render_template
from flask_login import login_required

new_bp = Blueprint('new', __name__)

@new_bp.route('/feature')
@login_required
def index():
    return render_template('new_feature.html')
åœ¨ app.py ä¸­æ³¨å†Œï¼š

python
from routes.new_feature import new_bp
app.register_blueprint(new_bp, url_prefix='/new')
2. Icon ä½¿ç”¨è¯´æ˜
Icon æ¥æºï¼šFont Awesome 6
å®˜ç½‘ï¼šhttps://fontawesome.com/icons

æ‰€æœ‰å›¾æ ‡éƒ½å¯ä»¥åœ¨è¿™é‡Œæœç´¢

Icon å‘½åè§„åˆ™ï¼š
fasï¼šå…è´¹å®å¿ƒå›¾æ ‡ï¼ˆFont Awesome Solidï¼‰

farï¼šå…è´¹ç©ºå¿ƒå›¾æ ‡ï¼ˆFont Awesome Regularï¼‰

fabï¼šå“ç‰Œå›¾æ ‡ï¼ˆFont Awesome Brandsï¼‰

å¸¸ç”¨å›¾æ ‡ç¤ºä¾‹ï¼š
python
# ç”¨æˆ·ç›¸å…³
'fas fa-user'        # ç”¨æˆ·
'fas fa-users'       # ç”¨æˆ·ç»„
'fas fa-user-plus'   # æ·»åŠ ç”¨æˆ·
'fas fa-user-minus'  # åˆ é™¤ç”¨æˆ·
'fas fa-user-cog'    # ç”¨æˆ·è®¾ç½®
'fas fa-user-shield' # ç”¨æˆ·æƒé™

# ç®¡ç†ç›¸å…³
'fas fa-cog'         # è®¾ç½®
'fas fa-cogs'        # å¤šä¸ªè®¾ç½®
'fas fa-tachometer-alt' # ä»ªè¡¨ç›˜
'fas fa-chart-bar'   # å›¾è¡¨
'fas fa-chart-line'  # è¶‹åŠ¿çº¿

# å†…å®¹ç›¸å…³
'fas fa-file'        # æ–‡ä»¶
'fas fa-folder'      # æ–‡ä»¶å¤¹
'fas fa-image'       # å›¾ç‰‡
'fas fa-file-alt'    # æ–‡æ¡£
'fas fa-edit'        # ç¼–è¾‘

# å·¥å…·ç›¸å…³
'fas fa-search'      # æœç´¢
'fas fa-filter'      # ç­›é€‰
'fas fa-sort'        # æ’åº
'fas fa-download'    # ä¸‹è½½
'fas fa-upload'      # ä¸Šä¼ 

# çŠ¶æ€ç›¸å…³
'fas fa-check'       # æˆåŠŸ
'fas fa-times'       # å¤±è´¥
'fas fa-exclamation' # è­¦å‘Š
'fas fa-info-circle' # ä¿¡æ¯
'fas fa-question-circle' # å¸®åŠ©

# å¯¼èˆªç›¸å…³
'fas fa-home'        # é¦–é¡µ
'fas fa-arrow-left'  # è¿”å›
'fas fa-arrow-right' # å‰è¿›
'fas fa-bars'        # èœå•
'fas fa-bell'        # é€šçŸ¥
'fas fa-envelope'    # é‚®ä»¶

# å“ç‰Œå›¾æ ‡
'fab fa-weixin'      # å¾®ä¿¡
'fab fa-qq'          # QQ
'fab fa-weibo'       # å¾®åš
'fab fa-github'      # GitHub
'fab fa-google'      # Google
3. æ–°åŠŸèƒ½çš„æƒé™æ§åˆ¶
3.1 è·¯ç”±çº§åˆ«æ§åˆ¶ï¼ˆåœ¨è·¯ç”±æ–‡ä»¶ä¸­ï¼‰
python
from flask_login import login_required

# éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®
@new_bp.route('/feature')
@login_required
def index():
    return render_template('new_feature.html')

# éœ€è¦ç®¡ç†å‘˜æƒé™
from functools import wraps
def admin_required(f):
    @wraps(f)
    def decorated(*args, **kwargs):
        if not current_user.is_authenticated:
            return redirect(url_for('auth.login'))
        if not current_user.is_admin:
            flash('éœ€è¦ç®¡ç†å‘˜æƒé™', 'danger')
            return redirect(url_for('main.index'))
        return f(*args, **kwargs)
    return decorated

@new_bp.route('/admin-feature')
@login_required
@admin_required
def admin_only():
    return render_template('admin_feature.html')

# å…¬å¼€è®¿é—®ï¼ˆä¸éœ€è¦ç™»å½•ï¼‰
@new_bp.route('/public')
def public():
    return render_template('public.html')
3.2 èœå•çº§åˆ«æ§åˆ¶ï¼ˆåœ¨èœå•é…ç½®ä¸­ï¼‰
python
# ç®¡ç†å‘˜èœå•
ADMIN_MENU_ITEMS = [
    {
        'title': 'æ–°åŠŸèƒ½',
        'endpoint': 'new.index',  # åªæœ‰ç®¡ç†å‘˜èƒ½çœ‹åˆ°
        'icon': 'fas fa-star',
        'permission': 'admin',  # â† æƒé™æ§åˆ¶
        'order': 5
    },
]

# æ™®é€šç”¨æˆ·èœå•
USER_MENU = [
    {
        'title': 'æ–°åŠŸèƒ½',
        'endpoint': 'new.index',  # åªæœ‰ç™»å½•ç”¨æˆ·èƒ½çœ‹åˆ°
        'icon': 'fas fa-star',
        'permission': 'user',  # â† æƒé™æ§åˆ¶
        'order': 5
    },
]

# å…¬å…±èœå•
PUBLIC_MENU = [
    {
        'title': 'æ–°åŠŸèƒ½',
        'endpoint': 'new.public',  # æ‰€æœ‰äººéƒ½èƒ½çœ‹åˆ°
        'icon': 'fas fa-star',
        'permission': 'public',  # â† æƒé™æ§åˆ¶
        'order': 5
    },
]
4. ç³»ç»Ÿæ‰€æœ‰ URL åˆ—è¡¨
4.1 å…¬å…±é¡µé¢ï¼ˆæ‰€æœ‰äººå¯è®¿é—®ï¼‰
åŠŸèƒ½	URL	è·¯ç”±åç§°	è¯´æ˜
é¦–é¡µ	/	main.index	æœªç™»å½•ç”¨æˆ·é¦–é¡µ
ç™»å½•	/auth/login	auth.login	ç”¨æˆ·ç™»å½•
æ³¨å†Œ	/auth/register	auth.register	ç”¨æˆ·æ³¨å†Œ
å…¬å‘Šåˆ—è¡¨	/announcements	announcements.announcement_list	æ‰€æœ‰å…¬å‘Š
å…³äºæˆ‘ä»¬	/about	main.about	å…³äºé¡µé¢
ç®¡ç†å‘˜å…¥å£	/admin-entry	main.admin_entry	ç®¡ç†å‘˜ç™»å½•å…¥å£
é‡å‘éªŒè¯é‚®ä»¶	/auth/resend-verification	auth.resend_verification	é‡æ–°å‘é€éªŒè¯é‚®ä»¶
4.2 æ™®é€šç”¨æˆ·é¡µé¢ï¼ˆéœ€è¦ç™»å½•ï¼‰
åŠŸèƒ½	URL	è·¯ç”±åç§°	è¯´æ˜
ç”¨æˆ·ä¸»é¡µ	/home	main.home	ç™»å½•åé¦–é¡µ
ä¸ªäººä¸­å¿ƒ	/profile	user.profile	æŸ¥çœ‹/ç¼–è¾‘ä¸ªäººèµ„æ–™
æ›´æ–°èµ„æ–™	/update-profile	user.update_profile	POST æäº¤
ä¿®æ”¹å¯†ç 	/change-password	user.change_password	POST æäº¤
ç”¨æˆ·åˆ—è¡¨	/users	user.user_list	æ™®é€šç”¨æˆ·åˆ—è¡¨ï¼ˆæœ‰é™ï¼‰
é€€å‡ºç™»å½•	/auth/logout	auth.logout	é€€å‡º
4.3 ç®¡ç†å‘˜é¡µé¢ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
åŠŸèƒ½	URL	è·¯ç”±åç§°	è¯´æ˜
ç®¡ç†å‘˜åå°	/admin/dashboard	admin.dashboard	æ§åˆ¶å°
ç”¨æˆ·ç®¡ç†	/admin/users	admin.user_management	ç®¡ç†æ‰€æœ‰ç”¨æˆ·
ç³»ç»Ÿè®¾ç½®	/admin/settings	admin.admin_settings	ç³»ç»Ÿè®¾ç½®
æ¸…ç†ç”¨æˆ·	/admin/cleanup-now	admin.cleanup_unverified_users_page	æ‰‹åŠ¨æ¸…ç†é¡µé¢
4.4 ç®¡ç†å‘˜ APIï¼ˆPOST/DELETE è¯·æ±‚ï¼‰
åŠŸèƒ½	URL	è·¯ç”±åç§°	è¯´æ˜
å¯ç”¨/ç¦ç”¨ç”¨æˆ·	/admin/api/users/<user_id>/toggle-active	admin.toggle_user_active	POST
è®¾ç½®/å–æ¶ˆç®¡ç†å‘˜	/admin/api/users/<user_id>/toggle-admin	admin.toggle_user_admin	POST
åˆ é™¤ç”¨æˆ·	/admin/api/users/<user_id>/delete	admin.delete_user	DELETE
APIæ¸…ç†ç”¨æˆ·	/admin/api/cleanup-unverified	admin.cleanup_unverified_users_api	POST
4.5 å…¬å‘Šç³»ç»Ÿ
åŠŸèƒ½	URL	è·¯ç”±åç§°	è¯´æ˜
å…¬å‘Šåˆ—è¡¨ï¼ˆå‰å°ï¼‰	/announcements	announcements.announcement_list	æ‰€æœ‰äººå¯è§
å…¬å‘Šè¯¦æƒ…	/announcements/<id>	announcements.view	éœ€è¦é…ç½®
å…¬å‘Šç®¡ç†ï¼ˆåå°ï¼‰	/announcements/admin	announcements.admin_dashboard	ç®¡ç†å‘˜
å‘å¸ƒå…¬å‘Š	/announcements/create	announcements.create_announcement	ç®¡ç†å‘˜
4.6 å¼€å‘å·¥å…·ï¼ˆä»…è°ƒè¯•æ¨¡å¼ï¼‰
åŠŸèƒ½	URL	è¯´æ˜
å¼ºåˆ¶é€€å‡º	/dev/force-logout	æ¸…é™¤ä¼šè¯
æ‰‹åŠ¨æ¸…ç†	/dev/cleanup-now	ç«‹å³æ¸…ç†æœªéªŒè¯ç”¨æˆ·
5. å¿«é€Ÿå‚è€ƒè¡¨
python
# å¸¸ç”¨è·¯ç”±é€ŸæŸ¥
ROUTES = {
    # è®¤è¯
    'auth.login': '/auth/login',
    'auth.register': '/auth/register',
    'auth.logout': '/auth/logout',
    'auth.admin_login': '/auth/admin/login',
    
    # ä¸»é¡µ
    'main.index': '/',
    'main.home': '/home',
    'main.about': '/about',
    
    # ç”¨æˆ·
    'user.profile': '/profile',
    'user.user_list': '/users',
    
    # ç®¡ç†å‘˜
    'admin.dashboard': '/admin/dashboard',
    'admin.user_management': '/admin/users',
    
    # å…¬å‘Š
    'announcements.announcement_list': '/announcements',
    'announcements.admin_dashboard': '/announcements/admin',
}
6. æ·»åŠ æ–°åŠŸèƒ½çš„å®Œæ•´ç¤ºä¾‹
python
# 1. åˆ›å»ºè·¯ç”±æ–‡ä»¶ routes/feedback.py
from flask import Blueprint, render_template
from flask_login import login_required

feedback_bp = Blueprint('feedback', __name__)

@feedback_bp.route('/feedback')
@login_required
def index():
    return render_template('feedback.html')

# 2. åœ¨ app.py ä¸­æ³¨å†Œ
from routes.feedback import feedback_bp
app.register_blueprint(feedback_bp)

# 3. åœ¨ config/admin_menu.py ä¸­æ·»åŠ èœå•
USER_MENU.append({
    'title': 'æ„è§åé¦ˆ',
    'endpoint': 'feedback.index',
    'icon': 'fas fa-comment',
    'permission': 'user',
    'order': 5
})

----------------------------------------------------
2æœˆ14æ—¥ç¬¬ä¸€æ¬¡æ›´æ–°ï¼Œè¡¥å……æ“ä½œ
--------------------------------------------------
éç¨‹åºå‘˜å¦‚ä½•ä¿®æ”¹èœå•ï¼š

æ‰“å¼€ E:\zlq\myweb\config\admin_menu.py

æ‰¾åˆ°å¯¹åº”çš„èœå•æ•°ç»„ï¼š

ADMIN_MENU_ITEMS - ç®¡ç†å‘˜èœå•

USER_MENU - æ™®é€šç”¨æˆ·èœå•

PUBLIC_MENU - å…¬å…±èœå•

æŒ‰ç…§ä»¥ä¸‹è§„åˆ™ä¿®æ”¹ï¼š

æ·»åŠ ä¸€çº§èœå•ï¼š

python
{
    'title': 'èœå•åç§°',
    'endpoint': 'è·¯ç”±åç§°',  # å¦‚ 'user.profile'
    'icon': 'å›¾æ ‡ç±»å',      # å¦‚ 'fas fa-user'
    'type': 'single',        # å›ºå®šå€¼
    'permission': 'æƒé™',     # admin/user/public
    'order': æ•°å­—             # æ’åºå·
}
æ·»åŠ ä¸¤çº§èœå•ï¼š

python
{
    'title': 'çˆ¶èœå•åç§°',
    'icon': 'å›¾æ ‡ç±»å',
    'type': 'parent',
    'permission': 'æƒé™',
    'order': æ•°å­—,
    'children': [
        {
            'title': 'å­èœå•1',
            'endpoint': 'è·¯ç”±åç§°',
            'icon': 'å›¾æ ‡ç±»å',
            'type': 'child'
        },
        {
            'title': 'å­èœå•2',
            'endpoint': 'è·¯ç”±åç§°',
            'icon': 'å›¾æ ‡ç±»å',
            'type': 'child'
        }
    ]
}
é‡å¯åº”ç”¨åå³å¯çœ‹åˆ°æ•ˆæœã€‚
-----------------------------------
ğŸ”§ MyWeb å¿«æ·æ“ä½œæ‰‹å†Œ
ğŸš€ å¯åŠ¨åº”ç”¨
python app.py â†’ http://localhost:5000


ğŸ‘‘ ç®¡ç†å‘˜å·¥å…·
python make_admin.py - è®¾ç½®ç®¡ç†å‘˜æƒé™
python debug_admin.py - è¯Šæ–­ç®¡ç†å‘˜é—®é¢˜ 




ğŸ‘¥ ç”¨æˆ·ç®¡ç†
python showuser.py - æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·çŠ¶æ€

ğŸ“ é¡¹ç›®æ–‡æ¡£
python generate_docs.py - ç”Ÿæˆç»“æ„æ–‡æ¡£PROJECT_STRUCTURE.md
python scan_project.py - æ˜¾ç¤ºç›®å½•æ ‘

ğŸ§ª æµ‹è¯•å·¥å…·
python test_db.py - æµ‹è¯•æ•°æ®åº“è¿æ¥

ğŸ”— é‡è¦è®¿é—®åœ°å€
âœ… ç”¨æˆ·ç™»å½•ï¼š/auth/login
âœ… ç”¨æˆ·æ³¨å†Œï¼š/auth/register
âœ… ç®¡ç†å‘˜åå°ï¼š/admin/dashboard
âœ… ç”¨æˆ·ä»ªè¡¨ç›˜ï¼š/dashboard
âœ… é€€å‡ºç™»å½•ï¼š/auth/logout

âš ï¸ è°ƒè¯•åœ°å€
/dev/force-logout - å¼ºåˆ¶é€€å‡ºï¼ˆå¼€å‘ç”¨ï¼‰
/list_routes - æŸ¥çœ‹æ‰€æœ‰è·¯ç”±ï¼ˆä¸´æ—¶æ·»åŠ ï¼‰

ğŸ“Š æ–‡ä»¶ç»Ÿè®¡
cat PROJECT_STRUCTURE.md - æŸ¥çœ‹é¡¹ç›®ç»“æ„
ls -la - æŸ¥çœ‹å½“å‰ç›®å½•æ–‡ä»¶

ğŸ“‹ å®Œæ•´URLåˆ—è¡¨
é¡µé¢	URL	è¯´æ˜
ç®¡ç†å‘˜ç™»å½•	http://localhost:5000/auth/admin/login	ğŸ‘‘ ä¸“å±ç®¡ç†å‘˜ç™»å½•
æ™®é€šç”¨æˆ·ç™»å½•	http://localhost:5000/auth/login	ğŸ‘¤ æ™®é€šç”¨æˆ·ç™»å½•
ç”¨æˆ·æ³¨å†Œ	http://localhost:5000/auth/register	æ–°ç”¨æˆ·æ³¨å†Œ
ç®¡ç†å‘˜åå°	http://localhost:5000/admin/dashboard	ç®¡ç†å‘˜æ§åˆ¶å°
ç”¨æˆ·ä»ªè¡¨ç›˜	http://localhost:5000/dashboard	æ™®é€šç”¨æˆ·ä¸»é¡µ


