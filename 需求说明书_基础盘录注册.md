--------------------------------------------------------
2月14日更新
MyWeb 项目需求文档
一、项目概述
1.1 项目背景
MyWeb 是一个基于 Flask 框架开发的 Web 应用系统，旨在提供一个功能完善、易于扩展的网站平台。系统支持用户注册、登录、权限管理、公告发布等功能，并设计了灵活的菜单配置系统，允许非技术人员通过配置文件调整网站菜单。

1.2 项目目标
建立一个稳定可靠的 Web 应用平台

实现用户分级管理（未登录用户、普通用户、管理员）

提供可配置的菜单系统，支持自定义菜单项

具备公告管理系统，支持公告发布和展示

确保系统易维护、易扩展

二、功能需求
2.1 用户认证系统
2.1.1 用户注册
支持新用户注册，需填写用户名、邮箱、密码

邮箱验证机制，注册后发送验证邮件

用户名唯一性检查

密码强度要求（至少6位）

2.1.2 用户登录
支持用户名/邮箱登录

记住我功能

登录状态维持

登录失败提示

2.1.3 密码管理
修改密码功能

密码加密存储

2.1.4 邮箱验证
注册后发送验证邮件

验证链接有效期（1小时）

可重新发送验证邮件

2.2 用户分级系统
2.2.1 未登录用户（游客）
可访问公共页面（首页、公告列表、关于我们等）

可查看公开菜单

可访问登录/注册页面

2.2.2 普通用户（已登录）
拥有未登录用户的所有权限

可访问个人中心

可修改个人信息

可修改密码

查看个人专属菜单

2.2.3 管理员用户
拥有普通用户的所有权限

可访问管理员后台

可进行用户管理（查看、禁用、删除用户）

可进行公告管理（发布、编辑、删除公告）

可清理未验证用户

查看管理员专属菜单

2.3 菜单系统
2.3.1 菜单配置化
菜单项可配置（非程序员可修改）

支持一级菜单和两级菜单混合使用

菜单按权限分级显示（公共、用户、管理员）

菜单按顺序排序

2.3.2 公共菜单（未登录用户可见）
首页

公告列表

关于我们

联系我们

2.3.3 普通用户菜单（登录后可见）
个人中心

消息中心（可包含子菜单）

我的收藏

账户设置（可包含子菜单）

2.3.4 管理员菜单（管理员可见）
控制台

用户管理

公告管理

系统设置（可包含子菜单）

日志查看

2.4 公告系统
2.4.1 公告列表（前台）
所有用户可查看公告列表

按发布时间倒序排列

显示公告标题、发布时间、摘要

2.4.2 公告详情
查看公告完整内容

显示发布时间、作者等信息

2.4.3 公告管理（后台）
管理员可发布新公告

管理员可编辑已有公告

管理员可删除公告

公告状态管理（发布/草稿）

2.5 用户管理（后台）
2.5.1 用户列表
分页显示所有用户

支持搜索（用户名/邮箱）

支持筛选（已验证/未验证/管理员等）

2.5.2 用户操作
启用/禁用用户

设置/取消管理员权限

删除用户（不能删除自己）

2.5.3 统计信息
总用户数

已验证用户数

未验证用户数

管理员数量

2.6 系统维护
2.6.1 未验证用户清理
自动清理（应用启动时）

手动清理（管理员操作）

清理条件：超过7天未验证邮箱

排除管理员账户

2.6.2 日志记录
记录重要操作

记录清理日志

三、非功能需求
3.1 用户体验
界面简洁友好

响应式设计，适配不同设备

操作反馈及时（提示信息）

导航清晰，面包屑导航

3.2 安全性
密码加密存储

登录状态管理

权限控制（防止越权访问）

CSRF 防护

Session 安全设置

3.3 可维护性
代码结构清晰，模块化设计

配置文件集中管理

菜单可配置（非程序员可修改）

注释完整

3.4 可扩展性
蓝图模块化，便于添加新功能

菜单系统可扩展，支持新菜单项

权限系统可扩展

支持动态功能添加

3.5 性能要求
页面加载速度快

数据库查询优化

分页加载大量数据

四、技术架构
4.1 后端技术
框架: Flask

数据库: MongoDB

用户认证: Flask-Login

邮件服务: Flask-Mail

密码加密: Werkzeug

4.2 前端技术
模板引擎: Jinja2

CSS框架: Bootstrap 5

图标库: Font Awesome 6

JavaScript: 原生 JS

4.3 项目结构
text
myweb/
├── app.py                 # 应用入口
├── config/                # 配置文件目录
│   ├── __init__.py
│   ├── config.py         # 应用配置
│   └── admin_menu.py     # 菜单配置（可被非程序员修改）
├── models/               # 数据模型
│   └── user.py
├── routes/               # 路由模块
│   ├── admin.py          # 管理员路由
│   ├── auth.py           # 认证路由
│   ├── main.py           # 主页路由
│   ├── user.py           # 用户路由
│   └── announcements.py  # 公告路由
├── templates/            # 模板文件
│   ├── layouts/          # 布局模板
│   │   ├── admin_layout.html
│   │   └── user_layout.html
│   ├── partials/         # 页面片段
│   │   ├── header.html
│   │   ├── footer.html
│   │   └── messages.html
│   ├── admin/            # 后台页面
│   ├── auth/             # 认证页面
│   └── ...               # 其他页面
├── static/               # 静态文件
│   ├── css/
│   └── js/
├── utils/                # 工具函数
│   ├── mailer.py
│   └── validators.py
└── uploads/              # 上传文件目录
五、菜单配置说明（面向非程序员）
5.1 配置文件位置
text
E:\zlq\myweb\config\admin_menu.py
5.2 菜单类型说明
5.2.1 一级菜单配置
python
{
    'title': '菜单名称',      # 显示的文字
    'endpoint': '路由名称',    # 如 'user.profile'
    'icon': '图标类名',        # 如 'fas fa-user'
    'type': 'single',         # 固定值，表示一级菜单
    'permission': '权限',      # admin/user/public
    'order': 数字              # 数字越小越靠前
}
5.2.2 两级菜单配置
python
{
    'title': '父菜单名称',     # 父菜单显示的文字
    'icon': '图标类名',        # 父菜单图标
    'type': 'parent',         # 固定值，表示父菜单
    'permission': '权限',      # 权限
    'order': 数字,             # 排序
    'children': [              # 子菜单列表
        {
            'title': '子菜单1',
            'endpoint': '路由名称',
            'icon': '图标类名',
            'type': 'child'
        },
        {
            'title': '子菜单2',
            'endpoint': '路由名称',
            'icon': '图标类名',
            'type': 'child'
        }
    ]
}
5.3 权限说明
public: 所有人可见（未登录用户）

user: 仅登录用户可见

admin: 仅管理员可见

5.4 修改示例
修改菜单名称
python
# 修改前
'title': '控制台',

# 修改后
'title': '仪表盘',
调整菜单顺序
python
# 修改前
'order': 3,

# 修改后
'order': 1,  # 放到最前面
添加新菜单
python
# 在 ADMIN_MENU_ITEMS 列表中添加
{
    'title': '数据分析',
    'endpoint': '#',  # 暂时无链接
    'icon': 'fas fa-chart-bar',
    'type': 'single',
    'permission': 'admin',
    'order': 6
}
添加两级菜单
python
{
    'title': '工具',
    'icon': 'fas fa-tools',
    'type': 'parent',
    'permission': 'admin',
    'order': 7,
    'children': [
        {
            'title': '备份管理',
            'endpoint': '#',
            'icon': 'fas fa-database',
            'type': 'child'
        },
        {
            'title': '缓存清理',
            'endpoint': '#',
            'icon': 'fas fa-broom',
            'type': 'child'
        }
    ]
}
5.5 注意事项
修改后保存文件，刷新页面即可生效（无需重启服务器）

endpoint 为 '#' 表示暂无链接

图标可从 Font Awesome 图标库 查找

注意 JSON 格式，每项之间用逗号分隔

六、项目状态
6.1 已完成功能
✅ 用户注册、登录、退出

✅ 邮箱验证

✅ 密码修改

✅ 用户分级（游客/普通用户/管理员）

✅ 可配置菜单系统（支持一级/两级菜单）

✅ 管理员后台

✅ 用户管理（列表、搜索、筛选、启用/禁用）

✅ 未验证用户清理（自动/手动）

✅ 个人中心

✅ 公告系统基础功能

6.2 待完成功能
⬜ 公告详情页

⬜ 公告发布/编辑页面

⬜ 更完善的权限控制

⬜ 操作日志记录

⬜ 系统设置页面

6.3 已知问题
公告详情路由未正确配置

部分页面菜单传递需要完善

七、部署说明
7.1 环境要求
Python 3.8+

MongoDB 4.0+

操作系统：Windows/Linux/MacOS

7.2 安装步骤
bash
# 克隆项目
git clone [项目地址]

# 进入项目目录
cd myweb

# 安装依赖
pip install -r requirements.txt

# 启动 MongoDB
# (确保 MongoDB 服务已启动)

# 运行应用
python app.py
7.3 配置文件修改
编辑 config/config.py 文件，修改以下配置：

SECRET_KEY: 应用密钥

MONGO_URI: MongoDB 连接地址

邮件配置（如需发送验证邮件）

八、联系方式
如有问题或需求，请联系项目管理员。

文档版本: 1.0
最后更新: 2026-02-14
---------------------------
2月9日需求更新
📋 完善后的需求文档
🎯 项目概述
项目名称：MyWeb 动态导航管理系统
目标：实现一个可后台配置、不影响现有框架的左侧导航系统
核心理念：配置化、模块化、低耦合

📊 详细功能需求
1. 导航系统核心功能
功能点	优先级	描述
动态菜单配置	🔴 高	管理员可在后台增删改查导航菜单项
多级菜单支持	🔴 高	支持无限级子菜单（建议不超过3级）
页面级导航	🟡 中	不同页面可显示不同的导航配置
角色权限控制	🔴 高	不同用户角色看到不同菜单
菜单缓存	🟢 低	减少数据库查询，提升性能
2. 管理员配置功能
功能点	描述	输入项
添加菜单	添加新的导航项	标题、图标、URL/路由、父菜单、排序、状态、权限角色
编辑菜单	修改现有菜单项	同上
删除菜单	软删除或硬删除	确认机制
批量操作	批量启用/禁用/排序	勾选批量处理
实时预览	配置时实时查看效果	模拟器
3. 技术特性需求
特性	要求
前后端分离	通过API接口交互
响应式设计	支持PC/平板/手机
缓存策略	Redis或内存缓存
错误处理	友好的错误提示
操作日志	记录所有配置变更
📁 项目文件结构建议
text
myweb/
├── app.py                    # 主程序入口
├── config.py                 # 配置文件
├── requirements.txt          # 依赖包
├── .env                      # 环境变量
├── models/                   # 数据模型
│   ├── __init__.py
│   └── nav_models.py        # 导航相关模型
├── utils/                    # 工具类
│   ├── __init__.py
│   ├── nav_utils.py         # 导航工具类
│   └── cache_manager.py     # 缓存管理
├── services/                 # 业务逻辑层
│   ├── __init__.py
│   └── nav_service.py       # 导航业务逻辑
├── routes/                   # 路由
│   ├── __init__.py
│   ├── nav_routes.py        # 导航相关路由
│   └── api/                 # API接口
│       └── nav_api.py
├── templates/               # 模板文件
│   ├── layouts/
│   │   ├── base_layout.html
│   │   └── base_with_sidebar.html
│   ├── admin/
│   │   ├── menu_list.html
│   │   ├── menu_form.html
│   │   └── menu_preview.html
│   └── dashboard.html
└── static/
    ├── css/
    │   └── sidebar.css     # 侧边栏样式
    └── js/
        └── nav_admin.js    # 导航管理JS
🔄 数据流设计
text
用户访问页面
    ↓
获取当前页面类型 (如：dashboard, settings)
    ↓
获取用户角色 (user, admin, guest)
    ↓
查询缓存 → 有缓存 → 返回菜单数据
    ↓     无缓存
查询数据库 → 按页面类型+角色过滤
    ↓
构建菜单树结构
    ↓
存入缓存 (设置过期时间)
    ↓
渲染侧边栏模板
    ↓
返回给用户
🗃️ 数据库设计扩展
1. 导航菜单表 (nav_menu)
sql
CREATE TABLE nav_menu (
    id INT PRIMARY KEY AUTO_INCREMENT,
    parent_id INT DEFAULT 0 COMMENT '父级ID，0表示顶级',
    title VARCHAR(100) NOT NULL COMMENT '菜单标题',
    icon VARCHAR(50) COMMENT 'FontAwesome图标类',
    url VARCHAR(255) COMMENT '直接URL链接',
    route_name VARCHAR(100) COMMENT 'Flask路由名称',
    page_type VARCHAR(50) DEFAULT 'default' COMMENT '页面类型：dashboard/admin/settings...',
    sort_order INT DEFAULT 0 COMMENT '排序号',
    is_active BOOLEAN DEFAULT TRUE COMMENT '是否启用',
    is_visible BOOLEAN DEFAULT TRUE COMMENT '是否显示',
    is_admin BOOLEAN DEFAULT FALSE COMMENT '仅管理员可见',
    permission_key VARCHAR(50) COMMENT '权限标识',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_parent (parent_id),
    INDEX idx_page_type (page_type),
    INDEX idx_sort (sort_order)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
2. 菜单-角色关联表 (menu_roles)
sql
CREATE TABLE menu_roles (
    id INT PRIMARY KEY AUTO_INCREMENT,
    menu_id INT NOT NULL,
    role_id INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY uk_menu_role (menu_id, role_id),
    FOREIGN KEY (menu_id) REFERENCES nav_menu(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
3. 菜单操作日志表 (menu_logs)
sql
CREATE TABLE menu_logs (
    id INT PRIMARY KEY AUTO_INCREMENT,
    menu_id INT,
    operator_id INT COMMENT '操作者ID',
    action VARCHAR(20) COMMENT '操作：create/update/delete',
    old_data JSON COMMENT '旧数据',
    new_data JSON COMMENT '新数据',
    ip_address VARCHAR(45),
    user_agent TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_menu (menu_id),
    INDEX idx_operator (operator_id),
    INDEX idx_created (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;-----------------------------------------
2月8日20时需求变更
-----------------------------------------
📋 补充需求文档
问题描述
导航不一致：普通页面和管理页面导航显示不一致

个人中心布局问题：点击个人中心后，左侧菜单样式改变，右侧内容不显示

公告页面导航丢失：公告页面缺少统一的导航栏

需要修复的功能
1. 统一导航系统
所有页面都应有统一的上方导航栏

导航栏包含：Logo、首页、公告、个人中心、管理员入口（对管理员显示）

用户登录状态显示用户名和退出按钮

2. 个人中心页面修复
修复个人中心页面布局

左侧显示用户菜单（我的信息、我的设置、我的活动等）

右侧显示对应内容

确保样式一致性

3. 页面布局统一
所有页面使用相同的基础布局模板

管理页面在基础布局上添加管理员侧边栏

普通用户页面只有顶部导航

4. 响应式设计
导航在不同设备上正常显示

移动设备显示汉堡菜单

需要创建的文件
基础模板文件
text
templates/
├── base.html                    # 基础模板，包含顶部导航
├── base_admin.html             # 管理页面基础模板（继承base.html）
└── layout/
    ├── navbar.html             # 顶部导航组件
    ├── admin_sidebar.html      # 管理员侧边栏
    └── user_sidebar.html       # 用户个人中心侧边栏
更新现有页面
text
templates/announcements/
    ├── list.html              # 继承 base.html
    ├── detail.html            # 继承 base.html
    └── admin/
        ├── dashboard.html     # 继承 base_admin.html
        ├── list.html          # 继承 base_admin.html
        ├── create.html        # 继承 base_admin.html
        └── edit.html          # 继承 base_admin.html
-----------------------------------------------------
2月8日18时需求更新，其他需求如和此有冲突按此执行
------------------------------------------

## 2.4 管理员功能详细需求

### 2.4.1 用户管理功能
- **用户列表查询**：分页显示所有用户信息
- **用户搜索功能**：按用户名、邮箱搜索用户
- **用户状态管理**：启用/禁用用户账户
- **管理员权限设置**：设置/取消用户的管理员权限

### 2.4.2 未验证用户清理
- **自动清理**：应用启动时自动清理超过7天未验证的用户
- **手动清理**：管理员可手动执行清理操作
- **安全保护**：不清理管理员账户（即使未验证）
- **日志记录**：详细记录清理操作

### 2.4.3 权限控制增强
- **登录入口隔离**：普通用户无法访问/admin/login
- **权限双重验证**：登录入口 + 用户类型双重检查
- **功能级权限**：管理员功能仅对管理员可见
-------------------------------------------
完整的系统，包含：

✅ 已完成的：登录、注册、个人中心、密码修改、邮箱验证、管理员功能

🔄 要新增的：可灵活配置的一级/二级导航菜单功能

🏠 主界面功能

让我为您重新整理一个完整的需求文档，包含现有功能和新增功能：

📋 MyWeb 完整系统需求文档
📄 文档信息
项目名称: MyWeb 全功能Web平台

文档版本: V2.0

创建日期: 2026-02-03

状态: 实施阶段

🏗️ 系统架构总览
text
MyWeb 全功能平台
├── ✅ 核心认证系统
│   ├── 用户注册/登录/退出
│   ├── 邮箱验证系统
│   ├── 会话管理
│   └── 安全防护
├── ✅ 用户管理中心
│   ├── 个人资料管理
│   ├── 密码修改
│   └── 头像设置
├── ✅ 管理员系统
│   ├── 用户管理
│   ├── 权限管理
│   └── 未验证用户清理
├── 🔄 动态功能系统（新增）
│   ├── 可配置导航菜单
│   ├── 功能页面管理
│   └── 权限控制
├── 🏠 主界面系统
│   ├── 仪表盘
│   ├── 功能导航
│   └── 信息展示
└── 📊 数据统计（可选）
    ├── 用户行为分析
    └── 系统使用统计
📋 第一部分：已实现功能（保持稳定）
1.1 用户认证系统 ✅
功能描述：完整的用户注册、登录、验证流程
已包含：

用户注册（带邮箱验证）

双通道登录（普通用户/管理员）

邮箱验证流程

会话管理和安全退出

"记住我"功能

密码加密存储

1.2 用户个人中心 ✅
功能描述：用户个人信息管理
已包含：

个人资料查看/编辑

头像设置和显示

密码修改（需验证原密码）

邮箱验证状态显示

响应式界面设计

1.3 管理员后台 ✅
功能描述：系统管理功能
已包含：

专用管理员登录入口

用户列表管理

用户状态控制（启用/禁用）

未验证用户清理（手动）

应用启动自动清理7天前未验证用户

管理员权限验证

🚀 第二部分：新增核心功能（动态导航系统）
2.1 动态导航菜单系统 🔄
目标：让管理员无需编程即可添加新功能

2.1.1 功能配置数据库设计
python
# MongoDB 集合设计
# collections: dynamic_functions
{
    "_id": "唯一ID",
    "name": "功能唯一标识",
    "title": "显示标题",
    "description": "功能描述",
    "url_path": "访问路径",
    "icon": "菜单图标",
    
    # 菜单配置
    "menu_level": 1,  # 1=一级菜单，2=二级菜单
    "parent_id": null,  # 父级菜单ID（二级菜单时使用）
    "menu_order": 10,  # 排序序号
    "show_in_menu": true,  # 是否显示在菜单
    "is_external": false,  # 是否外部链接
    
    # 页面配置
    "template_type": "page",  # page/form/list/custom
    "content": "页面内容HTML",
    "extra_css": "附加CSS",
    "extra_js": "附加JavaScript",
    
    # 权限控制
    "access_level": "all",  # all/public/auth/admin/custom
    "required_roles": [],  # 需要的角色
    "required_perms": [],  # 需要的权限
    
    # 状态管理
    "is_active": true,
    "created_at": "创建时间",
    "updated_at": "更新时间",
    "created_by": "创建者"
}
2.1.2 菜单层级结构
text
一级菜单示例：
├── 🏠 首页 (/)
├── 👤 个人中心 (/profile)
├── 📋 功能1 (/function1)
├── 📊 功能2 (/function2)
└── ⚙️ 设置 (/settings)

二级菜单示例：
├── 📁 文档中心
│   ├── 📄 用户手册
│   ├── 📋 操作指南
│   └── 📊 技术文档
├── 🛠️ 工具集
│   ├── 🔧 工具1
│   └── 🧰 工具2
└── 📈 报表
    ├── 📊 日报表
    └── 📈 月报表
2.2 功能页面管理系统 🔄
2.2.1 支持的功能类型
类型	描述	适用场景
基础页面	静态内容展示	帮助文档、公告、介绍页面
表单页面	数据收集表单	问卷调查、申请表单、反馈收集
列表页面	数据列表展示	新闻列表、产品目录、用户目录
自定义页面	HTML/CSS/JS自定义	特殊需求页面
外部链接	跳转到外部URL	第三方系统集成
2.2.2 内容编辑器功能
富文本编辑器（支持图片上传、表格、链接等）

Markdown编辑器

代码编辑器（HTML/CSS/JS）

实时预览功能

模板选择器

2.3 权限控制系统 🔄
2.3.1 访问级别定义
python
ACCESS_LEVELS = {
    "public": "公开访问（无需登录）",
    "all_users": "所有登录用户",
    "verified": "已验证邮箱用户", 
    "admin": "仅管理员",
    "custom": "自定义角色/权限"
}
2.3.2 权限检查流程
python
# 伪代码示例
def check_function_access(function_config, current_user):
    # 1. 检查功能是否激活
    if not function_config.is_active:
        return False
    
    # 2. 检查访问级别
    access_level = function_config.access_level
    
    if access_level == "public":
        return True
    elif not current_user.is_authenticated:
        return False
    elif access_level == "all_users":
        return True
    elif access_level == "verified" and current_user.email_verified:
        return True
    elif access_level == "admin" and current_user.is_admin:
        return True
    elif access_level == "custom":
        # 检查自定义角色/权限
        return check_custom_permission(function_config, current_user)
    
    return False
🏠 第三部分：主界面与用户体验
3.1 主仪表盘设计
3.1.1 用户仪表盘
text
用户登录后看到的主界面：
┌─────────────────────────────────────┐
│ 欢迎栏 [用户名] [通知] [快捷操作]      │
├──────────────┬──────────────────────┤
│ 左侧功能区     │ 主要内容区           │
│ ├─ 个人信息卡  │                     │
│ ├─ 快捷菜单    │ 1. 最近活动         │
│ ├─ 常用功能    │ 2. 系统公告         │
│ └─ 系统状态    │ 3. 待办事项         │
│              │ 4. 快速入门指南      │
└──────────────┴──────────────────────┘
3.1.2 管理员仪表盘
text
管理员专用界面：
┌─────────────────────────────────────┐
│ 系统管理控制台                        │
├──────────────┬──────────────────────┤
│ 管理导航      │ 系统概览             │
│ ├─ 用户管理    │ 1. 用户统计         │
│ ├─ 功能管理    │ 2. 系统状态         │
│ ├─ 系统设置    │ 3. 待处理事项       │
│ ├─ 数据统计    │ 4. 操作日志         │
│ └─ 工具集      │ 5. 性能监控         │
└──────────────┴──────────────────────┘
3.2 导航系统设计
3.2.1 顶部导航栏
html
<!-- 动态生成的导航菜单 -->
<nav class="navbar">
  <div class="navbar-brand">MyWeb</div>
  
  <div class="navbar-menu">
    <!-- 静态菜单项 -->
    <a href="/" class="nav-item">🏠 首页</a>
    <a href="/dashboard" class="nav-item">📊 仪表盘</a>
    
    <!-- 动态生成的一级菜单 -->
    {% for item in primary_menu %}
    <a href="{{ item.url }}" class="nav-item">
      {% if item.icon %}<i class="{{ item.icon }}"></i>{% endif %}
      {{ item.title }}
    </a>
    {% endfor %}
    
    <!-- 二级菜单下拉 -->
    {% for group in menu_groups %}
    <div class="nav-dropdown">
      <span class="nav-dropdown-trigger">
        {% if group.icon %}<i class="{{ group.icon }}"></i>{% endif %}
        {{ group.title }} ▼
      </span>
      <div class="nav-dropdown-content">
        {% for item in group.items %}
        <a href="{{ item.url }}" class="dropdown-item">
          {% if item.icon %}<i class="{{ item.icon }}"></i>{% endif %}
          {{ item.title }}
        </a>
        {% endfor %}
      </div>
    </div>
    {% endfor %}
  </div>
  
  <!-- 用户菜单 -->
  <div class="navbar-user">
    <span>{{ current_user.username }}</span>
    <div class="user-dropdown">
      <a href="/profile">👤 个人中心</a>
      <a href="/auth/logout">🚪 退出登录</a>
    </div>
  </div>
</nav>
3.2.2 侧边栏导航（可选）
用于复杂系统，提供更多导航空间

可折叠设计，节省空间

图标+文字组合，直观易用

🔧 第四部分：技术实现方案
4.1 数据库升级方案
4.1.1 新增集合
python
# 1. dynamic_functions - 动态功能配置
# 2. function_categories - 功能分类（可选）
# 3. function_access_logs - 访问日志（可选）
# 4. system_settings - 系统设置（用于存储导航配置等）
4.1.2 数据迁移策略
保持现有users集合不变

新增dynamic_functions集合

逐步迁移现有固定功能到动态配置

4.2 后端架构设计
4.2.1 新增路由结构
python
# routes/dynamic.py - 动态功能路由
dynamic_bp = Blueprint('dynamic', __name__)

@dynamic_bp.route('/<path:function_path>')
def dynamic_function(function_path):
    """动态功能路由 - 匹配所有动态功能URL"""
    # 1. 根据路径查找功能配置
    # 2. 检查权限
    # 3. 渲染对应模板
    pass

# routes/admin_dynamic.py - 动态功能管理
admin_dynamic_bp = Blueprint('admin_dynamic', __name__, url_prefix='/admin/dynamic')

@admin_dynamic_bp.route('/functions')
def function_list():
    """功能列表管理"""
    pass

@admin_dynamic_bp.route('/function/add', methods=['GET', 'POST'])
def add_function():
    """添加新功能"""
    pass

@admin_dynamic_bp.route('/function/<function_id>/edit', methods=['GET', 'POST'])
def edit_function(function_id):
    """编辑功能"""
    pass
4.2.2 中间件设计
python
# middleware/dynamic_menu.py - 动态菜单中间件
@app.context_processor
def inject_dynamic_menu():
    """向所有模板注入动态菜单数据"""
    if has_app_context():
        menu_data = get_dynamic_menu(current_user)
        return {'dynamic_menu': menu_data}
    return {}
4.3 前端组件设计
4.3.1 可复用组件
功能卡片组件：用于仪表盘显示功能入口

菜单生成器组件：动态生成导航菜单

富文本编辑器组件：功能内容编辑

权限选择器组件：设置功能访问权限

4.3.2 响应式设计
移动端：汉堡菜单，简化导航

平板端：适度简化，保持易用性

桌面端：完整功能，最佳体验

📋 第五部分：实施计划
5.1 开发阶段安排
阶段一：基础框架搭建（2天）
数据库设计和初始化

动态功能数据模型

基础服务层开发

阶段二：管理界面开发（3天）
功能管理后台

内容编辑器集成

权限配置界面

阶段三：前端集成（2天）
动态菜单生成

路由系统改造

模板渲染引擎

阶段四：测试优化（2天）
功能测试

性能测试

用户体验优化

5.2 优先级划分
高优先级（核心功能）
动态功能数据库设计 ✅

功能管理后台（CRUD）✅

动态菜单生成 ✅

权限控制系统 ✅

中优先级（增强功能）
富文本编辑器集成

多种页面模板支持

菜单拖拽排序

功能导入/导出

低优先级（优化功能）
访问统计和分析

功能使用日志

批量操作工具

高级搜索功能

5.3 风险控制
技术风险
性能风险：动态菜单可能影响页面加载速度

缓解：实现缓存机制，减少数据库查询

安全风险：动态内容可能引入XSS攻击

缓解：严格的内容过滤和转义

兼容性风险：不同浏览器渲染差异

缓解：充分测试，使用渐进增强策略

业务风险
用户接受度：管理员可能不熟悉配置界面

缓解：提供详细文档和培训视频

功能冲突：动态功能与现有功能URL冲突

缓解：URL命名规范，冲突检测机制

🎯 第六部分：成功标准
6.1 技术标准
✅ 动态功能添加时间 < 3分钟

✅ 页面加载时间增加 < 20%

✅ 系统可用性 ≥ 99.5%

✅ 零安全漏洞

6.2 业务标准
✅ 管理员满意度 ≥ 4/5

✅ 用户功能发现率 ≥ 85%

✅ 新功能上线周期缩短 80%

6.3 质量标准
✅ 代码覆盖率 ≥ 80%

✅ 文档完整率 100%

✅ 用户培训材料齐全

📞 附录
A.1 现有功能清单（保持）
用户注册/登录/退出

邮箱验证系统

个人中心（资料编辑、密码修改）

管理员后台（用户管理、清理工具）

自动清理过期用户

A.2 新增功能清单
动态功能配置系统

可配置导航菜单（一级/二级）

多种页面模板支持

灵活的权限控制系统

主界面优化和仪表盘

功能管理后台

A.3 技术栈确认
后端: Flask + MongoDB

前端: Bootstrap 5 + Jinja2

编辑器: CKEditor 5 / SimpleMDE

图标库: Font Awesome 6

部署: 保持现有部署方式

📋 实施确认清单
第一阶段准备
确认数据库设计

准备开发环境

备份现有系统

制定详细开发计划

开发过程
保持现有功能正常运行

分模块开发，逐步集成

每日进度同步

及时测试和反馈

上线准备
完整功能测试

性能压力测试

安全漏洞扫描

用户培训材料

备份和回滚方案

文档状态：✅ 需求明确 - 准备实施

这个文档涵盖了您需要的所有功能，包括：

✅ 已实现的登录注册个人中心等

🔄 新增的动态导航功能系统

🏠 主界面和用户体验优化

📊 完整的实施计划

接下来我们可以开始具体的设计和开发工作！

